<!DOCTYPE html>
<html><head>
  <meta charset="utf-8">

  <meta name="viewport"
        content="width=device-width,
                  initial-scale=1,
                  minimum-scale=1,
                  maximum-scale=1,
                  user-scalable=no,
                  minimal-ui">

  <link rel="apple-touch-icon" sizes="57x57" href="/favicons/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/favicons/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/favicons/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/favicons/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/favicons/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/favicons/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/favicons/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/favicons/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/favicons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="160x160" href="/favicons/favicon-160x160.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/favicons/favicon-192x192.png">
  <meta name="msapplication-TileColor" content="#00acc1">
  <meta name="msapplication-TileImage" content="/favicons/mstile-144x144.png">

  <link href="https://fonts.googleapis.com/css?family=Material+Icons&display=block" rel="stylesheet">
  <link rel="stylesheet" href="/bundle.css"/>
</head>
<body>

<div class="w-full fixed top-0">
  <div class="bg-[url('/images/background.svg')] bg-no-repeat [background-size:100%] py-[16px] px-[12px] flex flex-row">
    <a href="/">
      <img src="/images/v-icon-white.svg"/>
    </a>

    <div class="text-white pl-[20px] text-[20px] font-medium">
      Vanadium Core
    </div>

    <div class="grow"></div>

    <a href="https://github.com/" class="fill-white">
      <svg viewBox="0 0 16 16" class="w-[32px]">
        <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
      </svg>
    </a>
  </div>
</div><div class="fixed top-[64px] left-0 w-[200px] z-10 h-[calc(100%-64px)] bg-gray-50">
  <nav class="overflow-y-auto h-full py-4 pl-4 leading-[20px] text-[14px]">
    <a href="/overview">Overview</a>
    <a href="/installation">Installation</a>
    <div>Tutorials</div>
    <nav class="pl-3">
      <a href="/tutorials/hello-world">Hello World</a>
      <a href="/tutorials/basics">Client/Server Basics</a>

      <div>Security</div>
      <nav class="pl-3">
        <a href="/tutorials/security">Overview</a>
        <a href="/tutorials/security/principals-and-blessings">Principal and Blessings</a>
        <a href="/tutorials/security/permissions-authorizer">Permissions Authorizer</a>
        <a href="/tutorials/security/first-party-caveats">Caveats</a>
        <a href="/tutorials/security/third-party-caveats">Third-party Caveats</a>
        <a href="/tutorials/security/agent">The Agent</a>
        <a href="/tutorials/security/custom-authorizer">Customer Authorizer</a>
      </nav>

      <div>Naming</div>
      <nav class="pl-3">
        <a href="/tutorials/naming">Overview</a>
        <a href="/tutorials/naming/mount-table">The Mount Table</a>
        <a href="/tutorials/naming/namespace">Namespaces</a>
        <a href="/tutorials/naming/suffix-part1">The Suffix - Part I</a>
        <a href="/tutorials/naming/suffix-part2">The Suffix - Part II</a>
        <a href="/tutorials/naming/globber">Globber</a>
      </nav>

      <div>Java</div>
      <nav class="pl-3">
        <a href="/tutorials/java">Overview</a>
        <a href="/tutorials/java/fortune">Fortune in Java</a>
        <a href="/tutorials/java/android">Location Service in Android</a>
      </nav>

      <a href="/tutorials/faq">Tutorial FAQ</a>
    </nav>

    <div>Concepts</div>
    <nav class="pl-3">
      <a href="/concepts/rpc">RPC System</a>
      <a href="/concepts/naming">Naming</a>
      <a href="/concepts/security">Security</a>
      <a href="/concepts/device-management">Device Management</a>
    </nav>

    <div>Design Docs</div>
    <nav class="pl-3">
      <a href="/designdocs/authentication">Authentication Protocol</a>
      <a href="/designdocs/identity-service">Identity Service</a>
      <a href="/designdocs/vdl-spec">VDL Specification</a>
      <a href="/designdocs/vom-spec">VOM Specification</a>
    </nav>

    <a href="/api-reference">API Reference</a>
    <a href="/glossary">Glossary</a>
    <a href="/faq">FAQ</a>

    <div>Community</div>
    <nav class="pl-3">
      <a href="/community/coding-guidelines">Coding Guidelines</a>
      <a href="/community/contributing">Contributing</a>
      <a href="/community/mailing-lists">Mailing List</a>
      <a href="/community/roadmap">Roadmap</a>
    </nav>
  </nav>
</div>

  <div class="hidden xl:block fixed top-[64px] right-0 w-[200px] p-4 text-[14px] border-l-4 border-l-gray-100 h-[calc(100%-64px)]">
    <div class="uppercase font-medium pb-3">The Mount Table</div>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a>
      <ul>
        <li><a href="#credentials">Credentials</a></li>
      </ul>
    </li>
    <li><a href="#start-a-table">Start a table</a></li>
    <li><a href="#the-namespace-client">The namespace client</a>
      <ul>
        <li><a href="#mounting">Mounting</a></li>
        <li><a href="#globbing">Globbing</a></li>
        <li><a href="#resolution">Resolution</a></li>
      </ul>
    </li>
    <li><a href="#name-usage">Name usage</a>
      <ul>
        <li><a href="#the-namespace-variable">The namespace variable</a></li>
        <li><a href="#flags-vs-variables">Flags vs. variables</a></li>
        <li><a href="#many-names-one-endpoint">Many names, one endpoint</a></li>
        <li><a href="#many-endpoints-one-name">Many endpoints, one name</a></li>
      </ul>
    </li>
    <li><a href="#unmounting">Unmounting</a>
      <ul>
        <li><a href="#optionally-observe-failure">Optionally observe failure</a></li>
      </ul>
    </li>
    <li><a href="#cloud-service">Cloud service</a></li>
    <li><a href="#cleanup">Cleanup</a></li>
    <li><a href="#summary">Summary</a></li>
  </ul>
</nav>
  </div>

<div class="flex flex-col h-screen pt-[64px]">
  <div class="ml-[200px] px-11 w-[800px]">
    <h1 class="text-primary-color text-[48px]">The Mount Table</h1>

    
    <p><strong>Wherein</strong> you use the basic tools of service discovery.</p>
    
  <div class="my-8 -mx-4 px-4 border border-blue-grey-50/100 rounded">
    <p>
      <strong>Prerequisites</strong>:<br>
      All tutorials require Vanadium <a href="/installation/">installation</a>,
      and must run in a <a href="/tutorials/faq.html#why-bash-">bash shell</a>.
    </p>

    
      <p>
        Further, please
        <a href="/sh/scenario-b-setup.sh"
           download="scenario-b-setup.sh">
           download this script
        </a>
        then <a href="/tutorials/faq.html#why-source-">source</a> it:
      </p>

      <pre><code>source ~/Downloads/scenario-b-setup.sh</code></pre>

      <p>
        This command wipes tutorial files and defines shell environment
        variables. If you start a new terminal, and just want to re-establish
        the environment, see instructions
        <a href="/tutorials/setup.html">here</a>.
      </p>
    

    
  </div>

<content>
      <h1 id="introduction">Introduction</h1>
<p>This tutorial focusses on using a mount table with the <em>fortune</em>
server and client programs you made in the <a href="/2016/tutorials/basics.html">basics tutorial</a>, and just
re-made with the prerequisites script above.</p>
<h2 id="credentials">Credentials</h2>
<p>To keep security simple initially, all processes here will
<a href="/2016/tutorials/basics.html#authorization">use the same credentials</a>.  Further, credentials will be specified
using this environment variable:</p>
<!-- @setCredentials @test -->
<pre tabindex="0"><code>export V23_CREDENTIALS=$V_TUT/cred/basics
</code></pre><p>Vanadium programs consult this environment variable when the
credentials aren&rsquo;t specified by using the <code>--v23.credentials</code> flag,
or by using a <a href="/2016/tutorials/security/agent.html">security agent</a>.</p>
<h1 id="start-a-table">Start a table</h1>
<p>When you ran the fortune server in the <a href="/2016/tutorials/basics.html">basics tutorial</a>, you told it
to write its network <a href="/2016/glossary.html#endpoint">endpoint</a> to a file, then you told the client to
read that file so it would know where to find the server.</p>
<p>Let&rsquo;s do that again, but this time instead of using a file to hold the
endpoint, we&rsquo;ll use a server.</p>
<p>The server is called a <em>mount table</em>, and its executable has the name
<code>mounttabled</code>:</p>
<!-- @startMountTable @test @sleep -->
<pre tabindex="0"><code>PORT_MT=23000  # Pick an unused port.
kill_tut_process TUT_PID_MT
$V_BIN/mounttabled --v23.tcp.address :$PORT_MT &amp;
TUT_PID_MT=$!
</code></pre><p>A mount table happens to be a Vanadium service.  This means the <a href="/2016/tutorials/basics.html#the-vrpc-client">vrpc</a>
program can report its <a href="https://vanadium.googlesource.com/release.go.v23/+/master/services/mounttable/service.vdl">VDL interface</a>:</p>
<!-- @queryMountTable @test -->
<pre tabindex="0"><code>$V_BIN/vrpc signature -s /localhost:$PORT_MT
</code></pre><p>It also means that the mount table has a <a href="/2016/glossary.html#principal">principal</a> - it must run
with credentials.  Since the <code>--v23.credentials</code> flag wasn&rsquo;t
specified at startup, the Vanadium runtime consulted the environment
variable <code>V23_CREDENTIALS</code> (set above) to get the credentials.</p>
<p>Had credentials been left unspecified, randomly generated credentials
would have been used, and the problems reviewed at the
<a href="/2016/tutorials/basics.html#authorization">end of the basics tutorial</a> would happen below
when processes start talking to each other.  Mount table security will
be discussed in later tutorial.</p>
<p>The <code>-s</code> option stands for &lsquo;shallow resolve&rsquo;.  It forces vprc to apply
to mount table itself and not what might be mounted at its root.</p>
<h1 id="the-namespace-client">The namespace client</h1>
<p>The table is up, but empty.</p>
<p>Start the existing fortune server binary, so we have a service to put
in the table:</p>
<!-- @startFortune @test @sleep -->
<pre tabindex="0"><code>kill_tut_process TUT_PID_S1
$V_TUT/bin/server --endpoint-file-name $V_TUT/s1.txt &amp;
TUT_PID_S1=$!
</code></pre><h2 id="mounting">Mounting</h2>
<p><code>namespace</code> is a command line client dedicated to manipulating mount
tables.  The following mounts the server at the name <code>fortuneAlpha</code>.</p>
<!-- @mountFortune @test -->
<pre tabindex="0"><code>$V_BIN/namespace \
    --v23.namespace.root /localhost:$PORT_MT \
    mount fortuneAlpha `cat $V_TUT/s1.txt` 100m
</code></pre><p>The flag <code>--v23.namespace.root</code> specifies which <strong>mount table</strong> to
use.  The flag is available in all Vanadium programs.</p>
<p>In Vanadium, services live in hierachical trees called the
<strong>namespaces</strong>.  The <em>root</em> node of a tree is a mount table, hence the
flag name.  Other nodes are either services (leaves) or other mount
tables.</p>
<h2 id="globbing">Globbing</h2>
<p><em>To <a href="http://en.wikipedia.org/wiki/Glob_%28programming%29">glob</a></em> is to use a character pattern to select strings from a set.</p>
<p>The command <code>namespace glob *</code> reports the names of <em>all</em> known
names:</p>
<!-- @queryMountTable @test -->
<pre tabindex="0"><code>$V_BIN/namespace \
    --v23.namespace.root /localhost:$PORT_MT \
    glob -l '*'
</code></pre><p>There&rsquo;s just one name: <code>fortuneAlpha</code>.  Use of the flag <code>-l</code>
triggers additional output; you see the name&rsquo;s <a href="/2016/glossary.html#endpoint">endpoint</a>,
and you see it will expire (will be dropped from the table) in
about one hundred minutes.  That&rsquo;s what the <code>100m</code> meant in the
<code>mount</code> command above.</p>
<h2 id="resolution">Resolution</h2>
<p>When a name is known, and you just want to resolve it to an
<a href="/2016/glossary.html#endpoint">endpoint</a>, use <code>namespace resolve {name}</code>:</p>
<!-- @resolveFortune @test -->
<pre tabindex="0"><code>$V_BIN/namespace \
    --v23.namespace.root /localhost:$PORT_MT \
    resolve fortuneAlpha
</code></pre><p>The output should match the endpoint recorded in <code>$V_TUT/s1.txt</code>:</p>
<!-- @lookAtEndpoint @test -->
<pre tabindex="0"><code>cat $V_TUT/s1.txt
</code></pre><h1 id="name-usage">Name usage</h1>
<p>Recapping, here&rsquo;s how you connected the fortune client to the fortune
server using a full service endpoint name in the <a href="/2016/tutorials/basics.html">basics tutorial</a>:</p>
<!-- @reviewFortune @test -->
<pre tabindex="0"><code>$V_TUT/bin/client --server `cat $V_TUT/s1.txt`
</code></pre><p>Now you can use the name <code>fortuneAlpha</code> instead:</p>
<!-- @fortuneWithTable @test -->
<pre tabindex="0"><code>$V_TUT/bin/client \
    --v23.namespace.root /localhost:$PORT_MT \
    --server fortuneAlpha
</code></pre><p>The <code>client</code> program didn&rsquo;t need to be recompiled to allow this new
usage because Vanadium code in the client interprets the value
of the <code>--server</code> flag.</p>
<p>In the first command, <code>--server</code>&rsquo;s value was something like
<code>/@3@tcp@127.0.0.1:...</code>.  The leading <code>/</code> caused it to be interpreted
directly as an <a href="/2016/glossary.html#endpoint">endpoint</a> rather than as a service name to be used as
a lookup key.  That means communication attempts begin immediately,
and if the string doesn&rsquo;t refer to a live service, you won&rsquo;t know it
until the attempts timeout.</p>
<p>In the second command, <code>--server</code>&rsquo;s value was just <code>fortuneAlpha</code>.
Strings that don&rsquo;t start with <code>/</code> are treated as service names needing
a lookup.  If a lookup fails, the client will know it immediately, and
may retry depending on various configurations.</p>
<h2 id="the-namespace-variable">The namespace variable</h2>
<p>This tutorial uses only one mount table, and it&rsquo;s repetitive to
constantly specify the <code>--v23.namespace.root</code> flag with the same
value.</p>
<p>Ommiting the flag will trigger use the following shell variable:</p>
<!-- @setNamespace @test -->
<pre tabindex="0"><code>export V23_NAMESPACE=/localhost:$PORT_MT
</code></pre><p>Now a fortune retrieval is as simple as:</p>
<!-- @fortuneWithTableAgain @test -->
<pre tabindex="0"><code>$V_TUT/bin/client --server fortuneAlpha
</code></pre><h2 id="flags-vs-variables">Flags vs. variables</h2>
<p>In Vanadium, flag values, when specified, always trump the values of
corresponding shell variables.  So <code>--v23.namespace.root</code> trumps
<code>$V23_NAMESPACE</code>, and <code>--v23.credentials</code> trumps <code>$V23_CREDENTIALS</code>.</p>
<p>Shell variable values, in turn, trump default behavior.</p>
<p>The default behavior for unspecified namespace is to use a public
mount table maintained by the v23 team.  Circa April 2015 the service
runs at <code>ns.dev.v.io:8101</code>.  The port serves Vanadium protocol, not
HTTP.</p>
<p>The default behavior for unspecified credentials is to generate
<a href="/2016/tutorials/basics.html#authorization">random credentials</a>.</p>
<h2 id="many-names-one-endpoint">Many names, one endpoint</h2>
<p>A single service instance can have multiple names.  Mount the same
service again, with the name <code>fortuneBeta</code>, and a brief time to live:</p>
<!-- @mountFortune @test -->
<pre tabindex="0"><code>$V_BIN/namespace mount fortuneBeta `cat $V_TUT/s1.txt` 5m
</code></pre><p>Do the <code>glob</code> again:</p>
<!-- @doTheGlob @test -->
<pre tabindex="0"><code>$V_BIN/namespace glob -l '*'
</code></pre><p>You&rsquo;ll see two names, with the same endpoint, but with <em>different</em>
expiration times.  Later you&rsquo;ll find the names can have different
access control lists as well.</p>
<p>Confirm that the second name works:</p>
<!-- @fortuneViaOtherName @test -->
<pre tabindex="0"><code>$V_TUT/bin/client --server fortuneBeta
</code></pre><h2 id="many-endpoints-one-name">Many endpoints, one name</h2>
<p>Start a <strong>second instance</strong> of the fortune server:</p>
<!-- @startAnotherFortune @test @sleep -->
<pre tabindex="0"><code>kill_tut_process TUT_PID_S2
$V_TUT/bin/server --endpoint-file-name $V_TUT/s2.txt &amp;
TUT_PID_S2=$!
</code></pre><p>Mount it on the (original) name <code>fortuneAlpha</code>:</p>
<!-- @mountFortuneAgain @test -->
<pre tabindex="0"><code>$V_BIN/namespace mount fortuneAlpha `cat $V_TUT/s2.txt` 100m
</code></pre><p>List the names again:</p>
<!-- @doTheGlob @test -->
<pre tabindex="0"><code>$V_BIN/namespace glob -l '*'
</code></pre><p>Now the name <code>fortuneAlpha</code> reports two endpoints, with distinct
expiration times.</p>
<p>This is a means to implement redundancy, load sharing, etc.  The mount
table will resolve specific requests to one endpoint, but multiple
endpoints let it assign a server using simple rotation, or by using
load, response times, etc.</p>
<p>Confirm that <code>fortuneAlpha</code> still works (with two endpoints):</p>
<!-- @fortuneViaOriginalName @test -->
<pre tabindex="0"><code>$V_TUT/bin/client --server fortuneAlpha
</code></pre><p>Now kill the original server:</p>
<!-- @killTutS1 @test -->
<pre tabindex="0"><code>kill_tut_process TUT_PID_S1
</code></pre><p>And retry the request:</p>
<!-- @fortuneFromS2 @test -->
<pre tabindex="0"><code>$V_TUT/bin/client --server fortuneAlpha
</code></pre><p>You should still get a fortune, but this time it can only come from
the second server instance.</p>
<p>The mount table will still report the dangling endpoint until it
expires, as it might come back to life.</p>
<h1 id="unmounting">Unmounting</h1>
<p>Unmounting works as you might expect:</p>
<!-- @unmountFortune @test -->
<pre tabindex="0"><code>$V_BIN/namespace unmount fortuneAlpha `cat $V_TUT/s1.txt`
$V_BIN/namespace unmount fortuneBeta `cat $V_TUT/s1.txt`
</code></pre><p>That leaves only server 2 in the table (with the name <code>fortuneAlpha</code>):</p>
<!-- @globAfterUnmountFortune @test -->
<pre tabindex="0"><code>$V_BIN/namespace glob -l '*'
</code></pre><p>The reported endpoint should match the stored endpoint of server 2:</p>
<!-- @catS2Name @test -->
<pre tabindex="0"><code>cat $V_TUT/s2.txt
</code></pre><p>Unmount it as well:</p>
<!-- @globAfterUnmountFortune @test -->
<pre tabindex="0"><code>$V_BIN/namespace unmount fortuneAlpha `cat $V_TUT/s2.txt`
</code></pre><p>{{# helpers.warning }}</p>
<h2 id="optionally-observe-failure">Optionally observe failure</h2>
<p>Optionally, confirm that client use of the unmounted name <code>fortuneAlpha</code> fails.
Feel free to interrupt before the retry attempts exhaust themselves.</p>
<pre tabindex="0"><code>$V_TUT/bin/client --server fortuneAlpha
</code></pre><p>{{/ helpers.warning }}</p>
<p>{{# helpers.hidden }}</p>
<p>Must resolve <a href="https://github.com/veyron/release-issues/issues/1871">https://github.com/veyron/release-issues/issues/1871</a>
before exposing this part.</p>
<h1 id="cloud-service">Cloud service</h1>
<p>The Vanadium team plans to maintain several mount tables,
e.g. a public one at <code>ns.dev.v.io:8101</code>.  Try mounting your
service in it:</p>
<!-- @cloudCheck -->
<pre tabindex="0"><code>V23_NAMESPACE=/ns.dev.v.io:8101
sName=`hostname`Fortune
$V_BIN/namespace mount $sName `cat $V_TUT/s2.txt` 3m
$V_TUT/bin/client --server $sName
$V_BIN/namespace unmount $sName `cat $V_TUT/s2.txt`
unset sName
</code></pre><p>{{/ helpers.hidden }}</p>
<h1 id="cleanup">Cleanup</h1>
<!-- @cleanup @test -->
<pre tabindex="0"><code>kill_tut_process TUT_PID_S2
kill_tut_process TUT_PID_MT
unset V23_CREDENTIALS
unset V23_NAMESPACE
</code></pre><h1 id="summary">Summary</h1>
<ul>
<li>
<p>A service called <code>mounttabled</code> is a Vanadium service that helps
Vanadium services find each other.</p>
</li>
<li>
<p>The command-line client <code>namespace</code> performs
general operations on an instance of <code>mounttabled</code>.</p>
</li>
<li>
<p>The shell variables <code>$V23_CREDENTIALS</code> and <code>$V23_NAMESPACE</code>
can be used instead of flags to configure a Vanadium program.</p>
</li>
</ul>

    </content>
 </div>

 <nav class="flex flex-wrap-reverse mt-6 ml-[200px] z-[1]">
  

  
    
      <a href="/tutorials/naming/namespace/" class="p-8 flex justify-end items-center bg-primary-color grow">
        <div class="flex flex-col items-end">
          <div class="text-white/70 text-xs">Next</div>
          <div class="text-white">Namespaces</div>
        </div>
        <div class="flex items-center justify-center w-[48px] h-[48px]">
          <i class="material-icons text-white">arrow_forward</i>
        </div>
      </a>
    
  
</nav>

  
</div>

</body>
</html>
