<!DOCTYPE html>
<html><head>
  <meta charset="utf-8">

  <meta name="viewport"
        content="width=device-width,
                  initial-scale=1,
                  minimum-scale=1,
                  maximum-scale=1,
                  user-scalable=no,
                  minimal-ui">

  <link rel="apple-touch-icon" sizes="57x57" href="/favicons/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/favicons/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/favicons/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/favicons/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/favicons/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/favicons/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/favicons/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/favicons/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/favicons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="160x160" href="/favicons/favicon-160x160.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/favicons/favicon-192x192.png">
  <meta name="msapplication-TileColor" content="#00acc1">
  <meta name="msapplication-TileImage" content="/favicons/mstile-144x144.png">

  <link href="https://fonts.googleapis.com/css?family=Material+Icons&display=block" rel="stylesheet">
  <link rel="stylesheet" href="/bundle.css"/>
</head>
<body>

<div class="w-full fixed top-0">
  <div class="bg-[url('/images/background.svg')] bg-no-repeat [background-size:100%] py-[16px] px-[12px] flex flex-row">
    <a href="/">
      <img src="/images/v-icon-white.svg"/>
    </a>

    <div class="text-white pl-[20px] text-[20px] font-medium">
      Vanadium Core
    </div>

    <div class="grow"></div>

    <a href="https://github.com/" class="fill-white">
      <svg viewBox="0 0 16 16" class="w-[32px]">
        <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
      </svg>
    </a>
  </div>
</div><div class="fixed top-[64px] left-0 w-[200px] z-10 h-[calc(100%-64px)] bg-gray-50">
  <nav class="overflow-y-auto h-full py-4 pl-4 leading-[20px] text-[14px]">
    <a href="/overview">Overview</a>
    <a href="/installation">Installation</a>
    <div>Tutorials</div>
    <nav class="pl-3">
      <a href="/tutorials/hello-world">Hello World</a>
      <a href="/tutorials/basics">Client/Server Basics</a>

      <div>Security</div>
      <nav class="pl-3">
        <a href="/tutorials/security">Overview</a>
        <a href="/tutorials/security/principals-and-blessings">Principal and Blessings</a>
        <a href="/tutorials/security/permissions-authorizer">Permissions Authorizer</a>
        <a href="/tutorials/security/first-party-caveats">Caveats</a>
        <a href="/tutorials/security/third-party-caveats">Third-party Caveats</a>
        <a href="/tutorials/security/agent">The Agent</a>
        <a href="/tutorials/security/custom-authorizer">Customer Authorizer</a>
      </nav>

      <div>Naming</div>
      <nav class="pl-3">
        <a href="/tutorials/naming">Overview</a>
        <a href="/tutorials/naming/mount-table">The Mount Table</a>
        <a href="/tutorials/naming/namespace">Namespaces</a>
        <a href="/tutorials/naming/suffix-part1">The Suffix - Part I</a>
        <a href="/tutorials/naming/suffix-part2">The Suffix - Part II</a>
        <a href="/tutorials/naming/globber">Globber</a>
      </nav>

      <div>Java</div>
      <nav class="pl-3">
        <a href="/tutorials/java">Overview</a>
        <a href="/tutorials/java/fortune">Fortune in Java</a>
        <a href="/tutorials/java/android">Location Service in Android</a>
      </nav>

      <a href="/tutorials/faq">Tutorial FAQ</a>
    </nav>

    <div>Concepts</div>
    <nav class="pl-3">
      <a href="/concepts/rpc">RPC System</a>
      <a href="/concepts/naming">Naming</a>
      <a href="/concepts/security">Security</a>
      <a href="/concepts/device-management">Device Management</a>
    </nav>

    <div>Design Docs</div>
    <nav class="pl-3">
      <a href="/designdocs/authentication">Authentication Protocol</a>
      <a href="/designdocs/identity-service">Identity Service</a>
      <a href="/designdocs/vdl-spec">VDL Specification</a>
      <a href="/designdocs/vom-spec">VOM Specification</a>
    </nav>

    <a href="/api-reference">API Reference</a>
    <a href="/glossary">Glossary</a>
    <a href="/faq">FAQ</a>

    <div>Community</div>
    <nav class="pl-3">
      <a href="/community/coding-guidelines">Coding Guidelines</a>
      <a href="/community/contributing">Contributing</a>
      <a href="/community/mailing-lists">Mailing List</a>
      <a href="/community/roadmap">Roadmap</a>
    </nav>
  </nav>
</div>

  <div class="hidden xl:block fixed top-[64px] right-0 w-[200px] p-4 text-[14px] border-l-4 border-l-gray-100 h-[calc(100%-64px)]">
    <div class="uppercase font-medium pb-3">Caveats</div>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#start-server-with-permissions">Start server with permissions</a></li>
    <li><a href="#blessings-as-delegation">Blessings as delegation</a></li>
    <li><a href="#caveats">Caveats</a></li>
    <li><a href="#summary">Summary</a></li>
  </ul>
</nav>
  </div>

<div class="flex flex-col h-screen pt-[64px]">
  <div class="ml-[200px] px-11 w-[800px]">
    <h1 class="text-primary-color text-[48px]">Caveats</h1>

    
    <p><strong>Wherein</strong> Carol delegates the access that Alice gave her to Diane.  Carol does so without bothering Alice and without leaking secrets.  Carol constrains Diane&#39;s power with caveats.</p>
    
  <div class="my-8 -mx-4 px-4 border border-blue-grey-50/100 rounded">
    <p>
      <strong>Prerequisites</strong>:<br>
      All tutorials require Vanadium <a href="/installation/">installation</a>,
      and must run in a <a href="/tutorials/faq.html#why-bash-">bash shell</a>.
    </p>

    
      <p>
        Further, please
        <a href="/sh/scenario-d-setup.sh"
           download="scenario-d-setup.sh">
           download this script
        </a>
        then <a href="/tutorials/faq.html#why-source-">source</a> it:
      </p>

      <pre><code>source ~/Downloads/scenario-d-setup.sh</code></pre>

      <p>
        This command wipes tutorial files and defines shell environment
        variables. If you start a new terminal, and just want to re-establish
        the environment, see instructions
        <a href="/tutorials/setup.html">here</a>.
      </p>
    

    
  </div>

<content>
      <h1 id="start-server-with-permissions">Start server with permissions</h1>
<p>This tutorial uses the server with the Permissions authorizer
(described in the <a href="/2016/tutorials/security/permissions-authorizer.html">permissions-authorizer</a> tutorial):</p>
<!-- @startServerWithPerms @test @sleep -->
<pre tabindex="0"><code>kill_tut_process TUT_PID_SERVER
$V_TUT/bin/server \
    --v23.credentials $V_TUT/cred/alice \
    --endpoint-file-name $V_TUT/server.txt \
    --perms '{&quot;R&quot;: {&quot;In&quot;: [&quot;alice:family&quot;,
                           &quot;alice:friend&quot;]},
              &quot;W&quot;: {&quot;In&quot;: [&quot;alice:family&quot;]}}' &amp;
TUT_PID_SERVER=$!
</code></pre><h1 id="blessings-as-delegation">Blessings as delegation</h1>
<p><a href="/2016/glossary.html#blessing">Blessings</a> bind human-readable names (e.g.,
<code>alice:friend:bob</code>) to a principal (identified by its public
key). Principals are authorized based on these names.  For instance,
permissions provide a means of specifying authorization policy using a
list of patterns that match these names.</p>
<p>A principal can <a href="/2016/tutorials/security/principals-and-blessings.html#the-bless-operation">bless</a> another principal by
extending one of its names and binding it to the other principal.
This notion enables <em>delegation</em>, wherein a principal with access to
a resource by virtue of one of its names passes on that access to
another principal.</p>
<p>Earlier, Alice blessed Bob as <code>alice:friend:bob</code> and Carol as
<code>alice:family:sister</code>.  With respect to the permissions given to the
server (via <code>--perms</code>), this means Carol can invoke both <code>Add</code> and <code>Get</code>, but Bob can
only invoke <code>Get</code>.</p>
<p>Introduce Diane:</p>
<!-- @createDiane @test -->
<pre tabindex="0"><code>$V_BIN/principal create --with-passphrase=false --overwrite $V_TUT/cred/diane diane
</code></pre><p>As a new principal, Diane has no blessings (other than the default
&lsquo;self&rsquo; blessings), so she cannot read from (or write to) Alice&rsquo;s server:</p>
<!-- @dianeCannotRead -->
<pre tabindex="0"><code>$V_TUT/bin/client \
    --v23.credentials $V_TUT/cred/diane \
    --server `cat $V_TUT/server.txt`
</code></pre><p>Carol can extend her own blessing from Alice to provide Diane with
<code>alice:family:sister:guest</code>, thereby providing Diane with a blessing
that satisfies the permissions on Alice&rsquo;s server.</p>
<p>This allows Carol to share her access with Diane without involving
Alice and without any insecure workarounds (like sharing her private
key with Diane).</p>
<p>Three invocations of the <code>principal</code> command achieve this below.</p>
<ul>
<li>The first invocation fetches the blessing that Carol wishes to
extend.</li>
<li>The second uses that blessing to generate a new blessing for Diane.</li>
<li>The third stores the new blessing, setting Diane up so that this
blessing is presented to <code>alice</code>.</li>
</ul>
<!-- @carolDelegatesToDiane @test -->
<pre tabindex="0"><code>$V_BIN/principal get \
    --v23.credentials $V_TUT/cred/carol \
    forpeer alice | \
        $V_BIN/principal bless \
            --v23.credentials $V_TUT/cred/carol \
            --with - \
            --for 24h \
            $V_TUT/cred/diane guest | \
                $V_BIN/principal set \
                   --v23.credentials $V_TUT/cred/diane \
                   forpeer - alice
</code></pre><p><img src="/2016/images/tut/security05-carol-blesses-diane.svg" alt="Carol blesses Diane as a guest"></p>
<p>With this blessing, Diane can invoke both <code>Get</code> and <code>Add</code> method:</p>
<!-- @dianeCanNowAdd @test -->
<pre tabindex="0"><code>$V_TUT/bin/client \
    --v23.credentials $V_TUT/cred/diane \
    --server `cat $V_TUT/server.txt`

$V_TUT/bin/client \
    --v23.credentials $V_TUT/cred/diane \
    --server `cat $V_TUT/server.txt` \
    --add 'Diane says hello!'
</code></pre><p><img src="/2016/images/tut/security06-carol-diane-succeed.svg" alt="Diane can Get and Add to the server"></p>
<h1 id="caveats">Caveats</h1>
<p>Delegation via blessing allows Carol to grant Diane access to any
resources that Carol could access by virtue of her
<code>alice:family:sister</code> blessing.</p>
<p>This may make Diane as powerful as Carol, and Carol may not intend for
that. Carol can constrain the conditions under which Diane can use the
name <code>alice:family:sister:guest</code> by adding <a href="/2016/glossary.html#caveat"><em>caveats</em></a> to the
blessing.</p>
<p>Caveats are used to restrict the validity of a blessing to a scope,
such as invoking a particular method, communicating with a particular
peer, or any other arbitrary restriction. The API for generating
blessings (<code>v.io/v23/security.Principal.Bless</code>) allows for
these caveats to be specified.</p>
<p>The <code>principal</code> command-line tool supports adding an <em>expiry caveat</em>
to a blessing using the <code>--for {duration}</code> flag.</p>
<p>For example, Carol may bless Diane with the name
<code>alice:family:sister:guest</code> for only five seconds. The request to
<code>Add</code> will succeed if invoked immediately after the blessing is
generated but fail five seconds later:</p>
<!-- @carolBlessesDianeAsGuest @test -->
<pre tabindex="0"><code>$V_BIN/principal get \
    --v23.credentials $V_TUT/cred/carol \
    forpeer alice | \
        $V_BIN/principal bless \
            --v23.credentials $V_TUT/cred/carol \
            --with - \
			--for 5s \
            $V_TUT/cred/diane guest | \
                $V_BIN/principal set \
                    --v23.credentials $V_TUT/cred/diane \
                    forpeer - alice

$V_TUT/bin/client \
    --v23.credentials $V_TUT/cred/diane \
    --server `cat $V_TUT/server.txt` \
    --add 'Diane says hello again!'
</code></pre><p><img src="/2016/images/tut/security07-carol-blesses-diane-5sec.svg" alt="Carol blesses Diane with a 5-second caveat"></p>
<p><img src="/2016/images/tut/security08-diane-succeeds-5sec.svg" alt="Diane can get in temporarily"></p>
<p>Wait a few more seconds and this will fail:</p>
<pre tabindex="0"><code>$V_TUT/bin/client \
    --v23.credentials $V_TUT/cred/diane \
    --server `cat $V_TUT/server.txt` \
    --add 'Diane tries again.'
</code></pre><p>The second invocation of the <code>Add</code> method will fail with the error <code>does not match permissions</code> since the <code>alice:family:sister:guest</code> blessing is no longer
valid and Diane did not present any other blessings that match the permissions
at the server.</p>
<p><img src="/2016/images/tut/security09-diane-fails-5sec.svg" alt="After 5 seconds, Diane cannot access the server"></p>
<p>We&rsquo;re done with the server for now.</p>
<!-- @killServer @test -->
<pre tabindex="0"><code>kill_tut_process TUT_PID_SERVER
</code></pre><h1 id="summary">Summary</h1>
<ul>
<li>
<p>Carol is able to delegate her access to Alice&rsquo;s servers via blessings.</p>
</li>
<li>
<p>Blessings always have at least one caveat.</p>
</li>
<li>
<p>An expiry caveat makes the blessing expire after a specified amount
of time.</p>
</li>
</ul>

    </content>
 </div>

 <nav class="flex flex-wrap-reverse mt-6 ml-[200px] z-[1]">
  
    
      <a href="/tutorials/security/permissions-authorizer/" class="p-8 flex justify-start items-center bg-cyan-800 grow">
        <div class="flex items-center justify-center w-[48px] h-[48px]">
          <i class="material-icons text-white">arrow_back</i>
        </div>
        <div class="flex flex-col items-start">
          <div class="text-white/70 text-xs">Previous</div>
          <div class="text-white">Permissions Authorizer</div>
        </div>
      </a>
    
  

  
    
      <a href="/tutorials/security/third-party-caveats/" class="p-8 flex justify-end items-center bg-primary-color grow">
        <div class="flex flex-col items-end">
          <div class="text-white/70 text-xs">Next</div>
          <div class="text-white">Third-party Caveats</div>
        </div>
        <div class="flex items-center justify-center w-[48px] h-[48px]">
          <i class="material-icons text-white">arrow_forward</i>
        </div>
      </a>
    
  
</nav>

  
</div>

</body>
</html>
