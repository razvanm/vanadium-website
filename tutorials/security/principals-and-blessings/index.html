<!DOCTYPE html>
<html><head>
  <meta charset="utf-8">

  <meta name="viewport"
        content="width=device-width,
                  initial-scale=1,
                  minimum-scale=1,
                  maximum-scale=1,
                  user-scalable=no,
                  minimal-ui">

  <link rel="apple-touch-icon" sizes="57x57" href="https://razvanm.github.io/vanadium-website/favicons/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="114x114" href="https://razvanm.github.io/vanadium-website/favicons/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="72x72" href="https://razvanm.github.io/vanadium-website/favicons/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="144x144" href="https://razvanm.github.io/vanadium-website/favicons/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="60x60" href="https://razvanm.github.io/vanadium-website/favicons/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="120x120" href="https://razvanm.github.io/vanadium-website/favicons/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="76x76" href="https://razvanm.github.io/vanadium-website/favicons/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="152x152" href="https://razvanm.github.io/vanadium-website/favicons/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="https://razvanm.github.io/vanadium-website/favicons/apple-touch-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://razvanm.github.io/vanadium-website/favicons/favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://razvanm.github.io/vanadium-website/favicons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="https://razvanm.github.io/vanadium-website/favicons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="160x160" href="https://razvanm.github.io/vanadium-website/favicons/favicon-160x160.png">
  <link rel="icon" type="image/png" sizes="192x192" href="https://razvanm.github.io/vanadium-website/favicons/favicon-192x192.png">
  <meta name="msapplication-TileColor" content="#00acc1">
  <meta name="msapplication-TileImage" content="/favicons/mstile-144x144.png">

  <link href="https://fonts.googleapis.com/css?family=Material+Icons&display=block" rel="stylesheet">
  <link rel="stylesheet" href="https://razvanm.github.io/vanadium-website/bundle.css"/>
</head>
<body>

<div class="w-full fixed top-0">
  <div class="bg-[url('/images/background.svg')] bg-no-repeat [background-size:100%] py-[16px] px-[12px] flex flex-row">
    <a href="https://razvanm.github.io/vanadium-website/">
      <img src="https://razvanm.github.io/vanadium-website/images/v-icon-white.svg"/>
    </a>

    <div class="text-white pl-[20px] text-[20px] font-medium">
      Vanadium Core
    </div>

    <div class="grow"></div>

    <a href="https://github.com/" class="fill-white">
      <svg viewBox="0 0 16 16" class="w-[32px]">
        <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
      </svg>
    </a>
  </div>
</div><div class="fixed top-[64px] left-0 w-[200px] z-10 h-[calc(100%-64px)] bg-gray-50">
  <nav class="overflow-y-auto h-full py-4 pl-4 leading-[20px] text-[14px]">
    <a href="https://razvanm.github.io/vanadium-website/overview">Overview</a>
    <a href="https://razvanm.github.io/vanadium-website/installation">Installation</a>
    <div>Tutorials</div>
    <nav class="pl-3">
      <a href="https://razvanm.github.io/vanadium-website/tutorials/hello-world">Hello World</a>
      <a href="https://razvanm.github.io/vanadium-website/tutorials/basics">Client/Server Basics</a>

      <div>Security</div>
      <nav class="pl-3">
        <a href="https://razvanm.github.io/vanadium-website/tutorials/security">Overview</a>
        <a href="https://razvanm.github.io/vanadium-website/tutorials/security/principals-and-blessings">Principal and Blessings</a>
        <a href="https://razvanm.github.io/vanadium-website/tutorials/security/permissions-authorizer">Permissions Authorizer</a>
        <a href="https://razvanm.github.io/vanadium-website/tutorials/security/first-party-caveats">Caveats</a>
        <a href="https://razvanm.github.io/vanadium-website/tutorials/security/third-party-caveats">Third-party Caveats</a>
        <a href="https://razvanm.github.io/vanadium-website/tutorials/security/agent">The Agent</a>
        <a href="https://razvanm.github.io/vanadium-website/tutorials/security/custom-authorizer">Customer Authorizer</a>
      </nav>

      <div>Naming</div>
      <nav class="pl-3">
        <a href="https://razvanm.github.io/vanadium-website/tutorials/naming">Overview</a>
        <a href="https://razvanm.github.io/vanadium-website/tutorials/naming/mount-table">The Mount Table</a>
        <a href="https://razvanm.github.io/vanadium-website/tutorials/naming/namespace">Namespaces</a>
        <a href="https://razvanm.github.io/vanadium-website/tutorials/naming/suffix-part1">The Suffix - Part I</a>
        <a href="https://razvanm.github.io/vanadium-website/tutorials/naming/suffix-part2">The Suffix - Part II</a>
        <a href="https://razvanm.github.io/vanadium-website/tutorials/naming/globber">Globber</a>
      </nav>

      <div>Java</div>
      <nav class="pl-3">
        <a href="https://razvanm.github.io/vanadium-website/tutorials/java">Overview</a>
        <a href="https://razvanm.github.io/vanadium-website/tutorials/java/fortune">Fortune in Java</a>
        <a href="https://razvanm.github.io/vanadium-website/tutorials/java/android">Location Service in Android</a>
      </nav>

      <a href="https://razvanm.github.io/vanadium-website/tutorials/faq">Tutorial FAQ</a>
    </nav>

    <div>Concepts</div>
    <nav class="pl-3">
      <a href="https://razvanm.github.io/vanadium-website/concepts/rpc">RPC System</a>
      <a href="https://razvanm.github.io/vanadium-website/concepts/naming">Naming</a>
      <a href="https://razvanm.github.io/vanadium-website/concepts/security">Security</a>
      <a href="https://razvanm.github.io/vanadium-website/concepts/device-management">Device Management</a>
    </nav>

    <div>Design Docs</div>
    <nav class="pl-3">
      <a href="https://razvanm.github.io/vanadium-website/designdocs/authentication">Authentication Protocol</a>
      <a href="https://razvanm.github.io/vanadium-website/designdocs/identity-service">Identity Service</a>
      <a href="https://razvanm.github.io/vanadium-website/designdocs/vdl-spec">VDL Specification</a>
      <a href="https://razvanm.github.io/vanadium-website/designdocs/vom-spec">VOM Specification</a>
    </nav>

    <a href="https://razvanm.github.io/vanadium-website/api-reference">API Reference</a>
    <a href="https://razvanm.github.io/vanadium-website/glossary">Glossary</a>
    <a href="https://razvanm.github.io/vanadium-website/faq">FAQ</a>

    <div>Community</div>
    <nav class="pl-3">
      <a href="https://razvanm.github.io/vanadium-website/community/coding-guidelines">Coding Guidelines</a>
      <a href="https://razvanm.github.io/vanadium-website/community/contributing">Contributing</a>
      <a href="https://razvanm.github.io/vanadium-website/community/mailing-lists">Mailing List</a>
      <a href="https://razvanm.github.io/vanadium-website/community/roadmap">Roadmap</a>
    </nav>
  </nav>
</div>

  <div class="hidden xl:block fixed top-[64px] right-0 w-[200px] p-4 text-[14px] border-l-4 border-l-gray-100 h-[calc(100%-64px)]">
    <div class="uppercase font-medium pb-3">Principals and Blessings</div>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#principals">Principals</a></li>
    <li><a href="#default-authorization-policy">Default authorization policy</a></li>
    <li><a href="#blessings">Blessings</a>
      <ul>
        <li><a href="#alice-and-bob-would-typically-be-on-different-devices">Alice and Bob would typically be on different devices.</a></li>
      </ul>
    </li>
    <li><a href="#steps-to-authentication">Steps to authentication</a></li>
    <li><a href="#summary">Summary</a></li>
    <li><a href="#appendix--reporting-credentials">Appendix:  Reporting credentials</a>
      <ul>
        <li><a href="#alice">Alice</a>
          <ul>
            <li><a href="#public-key">Public key</a></li>
            <li><a href="#blessings-presented-as-server">Blessings presented as server</a></li>
            <li><a href="#blessings-presented-as-a-client">Blessings presented as a client</a></li>
            <li><a href="#recognized-roots">Recognized roots</a></li>
          </ul>
        </li>
        <li><a href="#bob">Bob</a>
          <ul>
            <li><a href="#public-key-1">Public key</a></li>
            <li><a href="#blessings-presented-as-server-1">Blessings presented as server</a></li>
            <li><a href="#blessings-presented-as-a-client-1">Blessings presented as a client</a></li>
            <li><a href="#recognized-roots-1">Recognized roots</a></li>
          </ul>
        </li>
        <li><a href="#blessing-details">Blessing details</a>
          <ul>
            <li><a href="#names">Names</a></li>
            <li><a href="#root-keys">Root keys</a></li>
            <li><a href="#caveats">Caveats</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>

<div class="flex flex-col h-screen pt-[64px]">
  <div class="ml-[200px] px-11 w-[800px]">
    <h1 class="text-primary-color text-[48px]">Principals and Blessings</h1>

    
    <p><strong>Wherein</strong> Alice and her friend Bob take the stage to demonstrate inter-principal communication.</p>
    
  <div class="my-8 -mx-4 px-4 border border-blue-grey-50/100 rounded">
    <p>
      <strong>Prerequisites</strong>:<br>
      All tutorials require Vanadium <a href="https://razvanm.github.io/vanadium-website/installation/">installation</a>,
      and must run in a <a href="https://razvanm.github.io/vanadium-website/tutorials/faq.html#why-bash-">bash shell</a>.
    </p>

    
      <p>
        Further, please
        <a href="https://razvanm.github.io/vanadium-website/sh/scenario-b-setup.sh"
           download="scenario-b-setup.sh">
           download this script
        </a>
        then <a href="https://razvanm.github.io/vanadium-website/tutorials/faq.html#why-source-">source</a> it:
      </p>

      <pre><code>source ~/Downloads/scenario-b-setup.sh</code></pre>

      <p>
        This command wipes tutorial files and defines shell environment
        variables. If you start a new terminal, and just want to re-establish
        the environment, see instructions
        <a href="https://razvanm.github.io/vanadium-website/tutorials/setup.html">here</a>.
      </p>
    

    
  </div>

<content>
      <h1 id="principals">Principals</h1>
<p>A <a href="https://razvanm.github.io/vanadium-website/2016/glossary.html#principal"><em>principal</em></a> in the Vanadium framework is simply a public and
private <a href="http://en.wikipedia.org/wiki/Public-key_cryptography">key pair</a>. It has a set of human-readable names bound to it
using public-key certificate chains, called <a href="https://razvanm.github.io/vanadium-website/2016/glossary.html#blessing"><em>blessings</em></a>.
All Vanadium processes act on behalf of a principal and are authorized by
other processes based on the blessing names bound to the principal.</p>
<p>For example a principal <em>Alice</em> may have the blessings <code>alice</code> and
<code>bob:houseguest</code> bound to it. A process running on behalf of Alice
may authenticate to others as either <code>alice</code> or <code>bob:houseguest</code> or both.</p>
<p>A principal and the set of blessings bound to it, are together
referred to as <em>credentials</em>.  The <a href="https://razvanm.github.io/vanadium-website/2016/tutorials/basics.html">basics tutorial</a> demonstrated that
a client and server can talk to each other if they run with the <em>same
credentials</em>.</p>
<p>To reiterate this, create two principals Alice and Bob with blessings
<code>alice</code> and <code>bob</code> bound to them respectively:</p>
<!-- @makeAliceAndBob @test @completer -->
<pre tabindex="0"><code>$V_BIN/principal create --with-passphrase=false --overwrite $V_TUT/cred/alice alice
$V_BIN/principal create --with-passphrase=false --overwrite $V_TUT/cred/bob bob
</code></pre><p>Run the server with Alice&rsquo;s credentials (i.e, authenticate as <code>alice</code>):</p>
<!-- @runServerAsAlice @test @sleep -->
<pre tabindex="0"><code>kill_tut_process TUT_PID_SERVER
$V_TUT/bin/server \
    --v23.credentials $V_TUT/cred/alice \
    --endpoint-file-name $V_TUT/server.txt &amp;
TUT_PID_SERVER=$!
</code></pre><p>then make a request as Alice:</p>
<!-- @runClientAsAlice @test -->
<pre tabindex="0"><code>$V_TUT/bin/client \
    --v23.credentials $V_TUT/cred/alice \
    --server `cat $V_TUT/server.txt`
</code></pre><p>then make a request as Bob (it should fail):</p>
<pre tabindex="0"><code>$V_TUT/bin/client \
    --v23.credentials $V_TUT/cred/bob \
    --server `cat $V_TUT/server.txt`
</code></pre><p>The reason the request from Alice succeeds and that from Bob
fails is because of the Default Authorization Policy used by
the server.</p>
<p><img src="https://razvanm.github.io/vanadium-website/2016/images/tut/security01-alice-succeeds-bob-fails.svg" alt="Alice&rsquo;s request to the server succeeds, but Bob&rsquo;s request fails"></p>
<h1 id="default-authorization-policy">Default authorization policy</h1>
<p>In the absence of any explicit indications by the developer, Vanadium
services use the following default policy:</p>
<blockquote>
<p><em>Servers authorize clients if the client&rsquo;s blessings are an extension of the server&rsquo;s,
or the server&rsquo;s blessings are an extension of the client&rsquo;s.</em></p>
</blockquote>
<p>For example, a server that presents the blessing <code>alice:hometv</code> to
clients will authorize only clients that present either <code>alice</code>, or <code>alice:hometv</code>,
or <code>alice:hometv:app</code>, etc. to the server.</p>
<p>In the sample run above, <em>Alice the server</em> recognizes <em>Alice the client</em> as herself
(same principal and blessing), and therefore grants access under the default authorization
policy.</p>
<p>Under the same policy, Alice&rsquo;s server rejects Bob&rsquo;s request, as neither <code>alice</code>
nor <code>bob</code> is an extension of the other.</p>
<h1 id="blessings">Blessings</h1>
<p>Per the default authorization policy, Bob&rsquo;s request to Alice&rsquo;s server would
succeed if he had a blessing of the form <code>alice:&lt;something&gt;</code>. Such a blessing
can be created by Alice by <em>blessing</em> Bob.</p>
<p>A principal can <em>bless</em> another principal by extending a subset
of its own blessings and create a blessing for the other principal.
This operation can be carried out by the <code>principal</code> command:</p>
<!-- @aliceBlessBobAsFriend @test @completer -->
<pre tabindex="0"><code>$V_BIN/principal bless \
    --v23.credentials $V_TUT/cred/alice \
    --for=24h $V_TUT/cred/bob friend:bob | \
        $V_BIN/principal \
            --v23.credentials $V_TUT/cred/bob \
            set forpeer - alice
</code></pre><p>In the first invocation of <code>principal</code>, Alice creates a blessing for Bob
named <code>alice:friend:bob</code>. A blessing can carry an expiry time (along with
other restrictions, explained in subsequent tutorials) after which it is
no longer valid.</p>
<p>The second invocation takes that blessing off the pipe and
stores it for later use by Bob when talking to Alice&rsquo;s server.</p>
<p>{{# helpers.info }}</p>
<h2 id="alice-and-bob-would-typically-be-on-different-devices">Alice and Bob would typically be on different devices.</h2>
<p>A blessing does not contain any private keys and is useful only to the one
blessed, so it could be transferred via email without compromising its purpose.</p>
<p>Blessings are transferred via pipes in this tutorial for educational brevity.
Later tutorials will show (with more coding details) how a blessing can directly
accompany the request that the blessing authorizes.
{{/ helpers.info }}</p>
<p><img src="https://razvanm.github.io/vanadium-website/2016/images/tut/security02-alice-blesses-bob.svg" alt="Alice blesses Bob as a friend"></p>
<p>Because Bob has stored the new blessing with his credentials,
the same request from Bob that previously failed now succeeds:</p>
<!-- @clientAsBob @test -->
<pre tabindex="0"><code>$V_TUT/bin/client \
    --v23.credentials $V_TUT/cred/bob \
    --server `cat $V_TUT/server.txt`
</code></pre><p><img src="https://razvanm.github.io/vanadium-website/2016/images/tut/security03-alice-bob-succeed.svg" alt="Bob&rsquo;s request to the server succeeds"></p>
<p>We&rsquo;re done with the server now.</p>
<!-- @killServer @test -->
<pre tabindex="0"><code>kill_tut_process TUT_PID_SERVER
</code></pre><h1 id="steps-to-authentication">Steps to authentication</h1>
<p>In Vanadium, a remote procedure call is a multi-step process
authentication based on blessings:</p>
<ul>
<li>
<p>The client knocks on the door with an initial, ping-like request
that reveals little to the not-yet trusted server.</p>
</li>
<li>
<p>The server responds with one or more blessings - the server is
saying <em>who it is</em>.  A blessing is an identity.</p>
<p>Above, the server sends its blessing <code>alice</code>.  This allows the
client to establish the server&rsquo;s identity before revealing any
further information about the client&rsquo;s intent.</p>
</li>
<li>
<p>Based on the received blessings, the client choses which (if any) of
its blessings to reveal to the server, and sends them along with
its service request.</p>
<p>Above, Bob&rsquo;s client sent back two blessings: <code>bob</code> and
<code>alice:friend:bob</code>.  The former is always sent, and the latter is
sent to any server identifying itself as <code>alice</code>.</p>
</li>
<li>
<p>If the server authorizes the request for the given blessings, it
executes the service call and returns results.</p>
<p>Above, the blessing <code>alice:friend:bob</code> (originally generated by
alice and stored by bob) has authorization, so Bob gets his fortune.</p>
</li>
</ul>
<h1 id="summary">Summary</h1>
<ul>
<li>
<p>Alice and Bob have been established as <a href="https://razvanm.github.io/vanadium-website/2016/glossary.html#principal">principals</a>.</p>
</li>
<li>
<p>Alice ran a server, which Bob couldn&rsquo;t talk to.  Without changing
anything about the runner server, Alice <a href="https://razvanm.github.io/vanadium-website/2016/glossary.html#blessing">blessed</a> Bob and
Bob could talk to Alice&rsquo;s server.</p>
</li>
<li>
<p>The default authorization policy lets anyone that Alice blesses talk
to her without restriction.</p>
</li>
<li>
<p>The <code>principal</code> program reports credentials data</p>
<ul>
<li><code>principal dump</code> summarizes credentials.</li>
<li><code>principal get</code> drills into credential details.</li>
<li><code>principal dumpblessings</code> reports the detailed <a href="https://razvanm.github.io/vanadium-website/2016/glossary.html#certificate">certificate</a>
chains that comprise blessings.</li>
</ul>
</li>
</ul>
<h1 id="appendix--reporting-credentials">Appendix:  Reporting credentials</h1>
<p>{{# helpers.info }}</p>
<p>Feel free to skim this, and refer back to it from later tutorials as
the need arises.</p>
<p>{{/ helpers.info }}</p>
<p>This section reviews commands that display data from a principal&rsquo;s
credentials.  The <code>principal</code> subcommands shown here are handy to use
in all subsequent tutorials.</p>
<h2 id="alice">Alice</h2>
<p>The <code>dump</code> command summarizes a principal&rsquo;s credentials:</p>
<!-- @principalAliceDump @test -->
<pre tabindex="0"><code>$V_BIN/principal \
    --v23.credentials $V_TUT/cred/alice \
    dump
</code></pre><p>This results in something like:</p>
<p>{{# helpers.codeoutput }}
Public key : 0a:e3:61:0e:3e:ec:9c:ce:ed:04:c1:c6:58:78:28:a8
&mdash;&mdash;&mdash;&mdash;&mdash;- BlessingStore &mdash;&mdash;&mdash;&mdash;&mdash;-
Default blessings: alice
Peer pattern                   : Blessings
&hellip;                            : alice
&mdash;&mdash;&mdash;&mdash;&mdash;- BlessingRoots &mdash;&mdash;&mdash;&mdash;&mdash;-
Public key                                      : Pattern
0a:e3:61:0e:3e:ec:9c:ce:ed:04:c1:c6:58:78:28:a8 : [alice]
{{/ helpers.codeoutput }}</p>
<p>This output and its individual components are described below.</p>
<h3 id="public-key">Public key</h3>
<p>The <code>Public key</code> line shows the public half of Alice&rsquo;s public/private
key pair.  Isolate it as follows:</p>
<!-- @principalAliceGetPublicKey @test -->
<pre tabindex="0"><code>$V_BIN/principal \
    --v23.credentials $V_TUT/cred/alice \
    get publickey --pretty
</code></pre><h3 id="blessings-presented-as-server">Blessings presented as server</h3>
<p>The <code>Default blessings</code> line shows the blessings that the principal
will use when it <em>acts as a server</em> responding to a client.</p>
<p>These blessings will be revealed to all clients of the server,
regardless of the blessings presented by the client.</p>
<p>There can be more than one blessing; a principal can play multiple
roles - phone, music player, email client, etc.</p>
<p>Examine them as follows:</p>
<!-- @principalAliceGetDefault @test -->
<pre tabindex="0"><code>$V_BIN/principal \
    --v23.credentials $V_TUT/cred/alice \
    get default -names
</code></pre><h3 id="blessings-presented-as-a-client">Blessings presented as a client</h3>
<p>Below the headings <code>Peer pattern | Blessings</code> are the blessings used
when the principal <em>acts as a client</em>, sending its credentials to a
server.</p>
<p>This is a <em>peer map</em>.  The client takes the blessing that came from
the server, matches it to <a href="https://razvanm.github.io/vanadium-website/2016/glossary.html#blessing-pattern">patterns</a> on the left, and responds to the
server using the blessings on the right.</p>
<p>Examine the map as follows:</p>
<!-- @principalAliceGetPeerMap @test -->
<pre tabindex="0"><code>$V_BIN/principal \
    --v23.credentials $V_TUT/cred/alice \
    get peermap
</code></pre><p>The pattern <code>...</code> matches on all servers, so the name <code>alice</code> (the
name associated with her <a href="https://razvanm.github.io/vanadium-website/2016/glossary.html#self-blessing">self-blessing</a>) is provided to all servers.</p>
<h3 id="recognized-roots">Recognized roots</h3>
<p>The <code>BlessingRoots</code> section displays all
<a href="https://razvanm.github.io/vanadium-website/2016/glossary.html#blessing-root">root public keys</a> recognized by this principal.  The
blessing name patterns following a given public key are trusted if
they are presented by a principal with the given key.</p>
<p>Report just the recognized roots with:</p>
<!-- @principalAliceGetRoots @test -->
<pre tabindex="0"><code>$V_BIN/principal \
    --v23.credentials $V_TUT/cred/alice \
    get recognizedroots
</code></pre><p>There&rsquo;s only one key here because currently <code>alice</code> only recognizes
herself.</p>
<h2 id="bob">Bob</h2>
<p>The situation for Bob is slightly different:</p>
<!-- @principalBobDump @test -->
<pre tabindex="0"><code>$V_BIN/principal \
    --v23.credentials $V_TUT/cred/bob \
    dump
</code></pre><p>Example output:</p>
<p>{{# helpers.codeoutput }}
Public key : 8e:03:13:7b:f1:57:28:11:87:f0:e8:90:3b:5c:5f:fe
&mdash;&mdash;&mdash;&mdash;&mdash;- BlessingStore &mdash;&mdash;&mdash;&mdash;&mdash;-
Default blessings: bob
Peer pattern                   : Blessings
&hellip;                            : bob
alice                          : alice:friend:bob
&mdash;&mdash;&mdash;&mdash;&mdash;- BlessingRoots &mdash;&mdash;&mdash;&mdash;&mdash;-
Public key                                      : Pattern
0a:e3:61:0e:3e:ec:9c:ce:ed:04:c1:c6:58:78:28:a8 : [alice]
8e:03:13:7b:f1:57:28:11:87:f0:e8:90:3b:5c:5f:fe : [bob]
{{/ helpers.codeoutput }}</p>
<h3 id="public-key-1">Public key</h3>
<p>Critically, Bob has a different public key from Alice:</p>
<!-- @comparePublicKeys @test -->
<pre tabindex="0"><code>keyAlice=`$V_BIN/principal \
    --v23.credentials $V_TUT/cred/alice \
    get publickey --pretty`
keyBob=`$V_BIN/principal \
    --v23.credentials $V_TUT/cred/bob \
    get publickey --pretty`
echo -e &quot;alice   $keyAlice\n  bob   $keyBob&quot;
</code></pre><h3 id="blessings-presented-as-server-1">Blessings presented as server</h3>
<p>Bob will report himself to clients as <code>bob</code>:</p>
<!-- @principalBobGetDefault @test -->
<pre tabindex="0"><code>$V_BIN/principal \
    --v23.credentials $V_TUT/cred/bob \
    get default -names
</code></pre><h3 id="blessings-presented-as-a-client-1">Blessings presented as a client</h3>
<p>Bob&rsquo;s peer map shows that he has stored a blessing <code>alice:friend:bob</code>
that is sent only to servers that have identified themselves as
<code>alice</code>.</p>
<!-- @principalBobGetPeerMap @test -->
<pre tabindex="0"><code>$V_BIN/principal \
    --v23.credentials $V_TUT/cred/bob \
    get peermap
</code></pre><p>Bob also sends his <a href="https://razvanm.github.io/vanadium-website/2016/glossary.html#self-blessing">self-blessing</a> <code>bob</code> to everyone.</p>
<h3 id="recognized-roots-1">Recognized roots</h3>
<p>Bob, as a side effect of accepting a blessing from Alice, <em>remembers</em>
Alice&rsquo;s public key and will trust a principal claiming to be
<code>alice</code> only if it presents that public key.</p>
<!-- @principalBobGetRoots @test -->
<pre tabindex="0"><code>$V_BIN/principal \
    --v23.credentials $V_TUT/cred/bob \
    get recognizedroots
</code></pre><p>On the other hand, Alice&rsquo;s principal at this point has no record of
Bob&rsquo;s public key.  Her server honors Bob&rsquo;s request because Bob
presents a blessing rooted at her own public key.</p>
<h2 id="blessing-details">Blessing details</h2>
<p>The following command extracts the blessings Bob should use with Alice
and prints them in detail:</p>
<!-- @principalBobDumpBlessings @test -->
<pre tabindex="0"><code>$V_BIN/principal \
    --v23.credentials $V_TUT/cred/bob \
    get forpeer alice | \
         $V_BIN/principal dumpblessings -
</code></pre><p>Example output:</p>
<p>{{# helpers.codeoutput }}
Blessings          : bob#alice:friend:bob
PublicKey          : 8e:03:13:7b:f1:57:28:11:87:f0:e8:90:3b:5c:5f:fe
Certificate chains : 2
Chain #0 (1 certificates). Root certificate public key: 8e:03:13:7b:f1:57:28:11:87:f0:e8:90:3b:5c:5f:fe
Certificate #0: bob with 0 caveats
Chain #1 (2 certificates). Root certificate public key: 0a:e3:61:0e:3e:ec:9c:ce:ed:04:c1:c6:58:78:28:a8
Certificate #0: alice with 0 caveats
Certificate #1: friend:bob with 1 caveat
(0) security.unixTimeExpiryCaveat(1419279349 = 2014-12-22 12:15:49 -0800 PST)
{{/ helpers.codeoutput }}</p>
<p>Alice&rsquo;s public key is at the root of a
<a href="https://razvanm.github.io/vanadium-website/2016/glossary.html#certificate"><em>certificiate chain</em></a> corresponding to the blessing
<code>alice:friend:bob</code>.</p>
<h3 id="names">Names</h3>
<p>From the <code>dumpblessings</code> output, isolate
<a href="https://razvanm.github.io/vanadium-website/2016/glossary.html#blessing-name">blessing names</a> (the names presented to a server) with</p>
<!-- @principalBobGetForPeerName @test -->
<pre tabindex="0"><code>$V_BIN/principal \
    --v23.credentials $V_TUT/cred/bob \
    get forpeer -names alice
</code></pre><p>This shows that Bob will present <code>bob</code> and <code>alice:friend:bob</code>.</p>
<h3 id="root-keys">Root keys</h3>
<p>Examine <a href="https://razvanm.github.io/vanadium-website/2016/glossary.html#blessing-root">root keys</a> with</p>
<!-- @principalBobGetForPeerRoots @test -->
<pre tabindex="0"><code>$V_BIN/principal \
    --v23.credentials $V_TUT/cred/bob \
    get forpeer -rootkey=alice:friend:bob alice
</code></pre><p>That command answers the question</p>
<blockquote>
<p><em>Find the blessings <code>bob</code> will present to <code>alice</code>, and among them find
the blessing named <code>alice:friend:bob</code> and report the public key of
the principal it came from.</em></p>
</blockquote>
<p>In this case, the output should match Alice&rsquo;s public key:</p>
<!-- @echoAlicesKey @test -->
<pre tabindex="0"><code>echo $keyAlice
</code></pre><h3 id="caveats">Caveats</h3>
<p>Examine <a href="https://razvanm.github.io/vanadium-website/2016/glossary.html#caveat"><em>caveats</em></a> with</p>
<!-- @principalBobGetForPeerCaveats @test -->
<pre tabindex="0"><code>$V_BIN/principal \
    --v23.credentials $V_TUT/cred/bob \
    get forpeer -caveats=alice:friend:bob alice
</code></pre><p>That command answers the question</p>
<blockquote>
<p><em>Find the blessings <code>bob</code> will present to <code>alice</code>, and among them find
the blessing named <code>alice:friend:bob</code> and report its caveats.</em></p>
</blockquote>
<p>This shows that Bob&rsquo;s blessing from Alice will expire in about 24h.
That expiration was set using the <code>--for</code> flag in the <code>bless</code> command
<a href="#blessings">above</a>.</p>
<p>Caveats will be discussed in more depth in the <a href="https://razvanm.github.io/vanadium-website/2016/tutorials/security/first-party-caveats.html">caveats tutorial</a>.</p>

    </content>
 </div>

 <nav class="flex flex-wrap-reverse mt-6 ml-[200px] z-[1]">
  

  
    
      <a href="https://razvanm.github.io/vanadium-website/tutorials/security/permissions-authorizer/" class="p-8 flex justify-end items-center bg-primary-color grow">
        <div class="flex flex-col items-end">
          <div class="text-white/70 text-xs">Next</div>
          <div class="text-white">Permissions Authorizer</div>
        </div>
        <div class="flex items-center justify-center w-[48px] h-[48px]">
          <i class="material-icons text-white">arrow_forward</i>
        </div>
      </a>
    
  
</nav>

  
</div>

</body>
</html>
